[
  {
    "resourceType": "Organization",
    "tableMappings": [
      {
        "targetTable": "organization",
        "columnMappings": [
          {
            "columnName": "facility_id",
            "fhirPath": "Organization.id"
          },
          {
            "columnName": "facility_name",
            "fhirPath": "Organization.name"
          },
          {
            "columnName": "facility_code",
            "fhirPath": "Organization.identifier.where(system='http://test.org/identifier/hiv-organization').first().value"
          },
          {
            "columnName": "country",
            "fhirPath": "Organization.address.first().country"
          },
          {
            "columnName": "country_state_province",
            "fhirPath": "Organization.address.first().state"
          },
          {
            "columnName": "district",
            "fhirPath": "Organization.address.first().district"
          },
          {
            "columnName": "city",
            "fhirPath": "Organization.address.first().city"
          }
        ]
      }
    ]
  },
  {
    "resourceType": "Patient",
    "tableMappings": [
      {
        "targetTable": "patient",
        "columnMappings": [
          {
            "columnName": "patient_id",
            "fhirPath": "Patient.id"
          },
          {
            "columnName": "patient_gender",
            "fhirPath": "Patient.gender"
          },
          {
            "columnName": "patient_birthdate",
            "fhirPath": "Patient.birthDate"
          },
          {
            "columnName": "patient_district",
            "fhirPath": "Patient.address.district"
          },
          {
            "columnName": "patient_key_population",
            "fhirPath": "Patient.extension.where(url='http://openhie.org/fhir/hiv-casereporting/StructureDefinition/key-population').first().valueCodeableConcept.coding.first().code"
          },
          {
            "columnName": "facility_id",
            "fhirPath": "Patient.managingOrganization.reference.substring(13)"
          }
        ]
      }
    ]
  },
  {
    "resourceType": "Condition",
    "tableMappings": [
      {
        "targetTable": "condition",
        "columnMappings": [
          {
            "columnName": "patient_id",
            "fhirPath": "Condition.subject.reference.substring(8)"
          },
          {
            "columnName": "positive_hiv_diagnosis_date",
            "fhirPath": "Condition.recordedDate"
          },
          {
            "columnName": "covid_diagnosis",
            "fhirPath": "Condition.code.coding.first().code"
          }
        ]
      }
    ]
  },
  {
    "resourceType": "Specimen",
    "tableMappings": [
      {
        "targetTable": "specimen",
        "columnMappings": [
          {
            "columnName": "patient_id",
            "fhirPath": "Specimen.subject.reference.substring(8)"
          },
          {
            "columnName": "date_sample_collected",
            "fhirPath": "Specimen.collection.collectedDateTime"
          }
        ]
      }
    ]
  },
  {
    "resourceType": "ServiceRequest",
    "tableMappings": [
      {
        "targetTable": "service_request",
        "columnMappings": [
          {
            "columnName": "patient_id",
            "fhirPath": "ServiceRequest.subject.reference.substring(8)"
          },
          {
            "columnName": "test_requested",
            "fhirPath": "ServiceRequest.code.coding.where(system='http://loinc.org').first().name"
          }
        ]
      }
    ]
  },
  {
    "resourceType": "DiagnosticReport",
    "tableMappings": [
      {
        "targetTable": "diagnostic_report",
        "columnMappings": [
          {
            "columnName": "patient_id",
            "fhirPath": "DiagnosticReport.subject.reference.substring(8)"
          },
          {
            "columnName": "rapid_antigen_test_result",
            "fhirPath": "DiagnosticReport.code.coding.where(url='antigen').first().result"
          },
          {
            "columnName": "diagnostic_pcr_test_result",
            "fhirPath": "DiagnosticReport.code.coding.where(url='pcr').first().result"
          }
        ]
      }
    ]
  },
  {
    "resourceType": "Immunization",
    "tableMappings": [
      {
        "targetTable": "immunization",
        "columnMappings": [
          {
            "columnName": "vaccine_administered",
            "fhirPath": "Immunization.vaccineCode.coding.first().code"
          },
          {
            "columnName": "vaccine_dose",
            "fhirPath": "Immunization.protocolApplied.first().doseNumberPositiveInt"
          },
          {
            "columnName": "vaccination_date",
            "fhirPath": "Immunization.occurrenceDateTime"
          }
        ]
      }
    ]
  }
]
